<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Fusion OS v23 â€” Snap & Brain</title>

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root {
      --bg: #030303;
      --glass: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.08);
      
      /* DYNAMIC COLORS - CONTROLLED BY ARCHETYPE SYSTEM */
      --active-color: #38BDF8; /* Default ATLAS Blue */
      --active-glow: rgba(56, 189, 248, 0.18);
      --accent-secondary: #0EA5E9;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    
    body { 
      background: var(--bg); 
      color: #fff; 
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial;
      overflow: hidden; 
      height: 100vh; width: 100vw;
      user-select: none;
    }

    /* --- ATMOSPHERE --- */
    .ambient-glow {
        position: fixed; pointer-events: none; z-index: 0;
        border-radius: 50%; filter: blur(100px); opacity: 0.15;
        transition: background 1.5s ease;
    }
    #glow-top { top: -20%; left: -20%; width: 80vw; height: 80vw; background: var(--active-color); }
    #glow-bottom { bottom: -20%; right: -20%; width: 80vw; height: 80vw; background: var(--accent-secondary); opacity: 0.1; }

    /* --- VIEWPORT --- */
    #universe-viewport {
      display: flex;
      width: 300vw; 
      height: 100vh;
      transform: translateX(-100vw);
      transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
      position: relative; z-index: 10;
    }

    .screen-panel { 
        width: 100vw; height: 100vh; flex-shrink: 0; position: relative; 
        overflow: hidden; 
    }

    /* --- SCROLL SNAP SYSTEM (CINEMATIC SCROLL) --- */
    .snap-container {
        height: 100vh;
        width: 100%;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
        scrollbar-width: none; 
        -ms-overflow-style: none;
    }
    .snap-container::-webkit-scrollbar { display: none; }

    .snap-section {
        height: 100vh;
        width: 100%;
        scroll-snap-align: start;
        scroll-snap-stop: always;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    /* --- CORTEX & GENERAL UI --- */
    .memory-card {
      background: rgba(255,255,255,0.02);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 24px;
      transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
      position: relative; overflow: hidden;
    }
    .memory-card:hover { 
      background: rgba(255,255,255,0.05); 
      border-color: var(--active-color);
      transform: translateY(-2px);
    }
    .memory-card.pinned { border-left: 3px solid var(--active-color); }

    .tag-bubble {
      font-size: 8px; font-weight: 800; letter-spacing: 0.05em;
      padding: 4px 10px; border-radius: 100px;
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      text-transform: uppercase; color: rgba(255,255,255,0.5);
    }

    .glass-card {
        background: rgba(255,255,255,0.03);
        border: 1px solid rgba(255,255,255,0.05);
        backdrop-filter: blur(10px);
        border-radius: 24px;
    }

    .matrix-item {
        background: rgba(255,255,255,0.03);
        border: 1px solid rgba(255,255,255,0.05);
        border-radius: 18px;
        transition: 0.3s;
    }
    .matrix-item.active {
        border-color: var(--active-color);
        background: var(--active-glow);
    }

    .custom-scroll::-webkit-scrollbar { width: 4px; }
    .custom-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

    .glass-pill {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px; padding: 6px 14px;
      font-size: 10px; font-weight: 700; letter-spacing: 0.1em;
      text-transform: uppercase; color: #fff;
    }
    
    .tab-btn { opacity: 0.3; transition: 0.3s; position: relative; padding: 10px 0; }
    .tab-btn.active { opacity: 1; color: var(--active-color); }
    .tab-btn.active::after { content:''; position: absolute; bottom:0; left:50%; transform:translateX(-50%); width:4px; height:4px; border-radius:50%; background: var(--active-color); box-shadow: 0 0 10px var(--active-color); }

    /* VIDEO CAROUSEL */
    .video-row { display: flex; gap: 16px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
    .video-row::-webkit-scrollbar { display: none; }
    .video-card { width: 220px; flex-shrink: 0; position: relative; border-radius: 20px; overflow: hidden; }
    .played-badge { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); font-size: 8px; font-weight: 900; padding: 4px 8px; border-radius: 8px; backdrop-filter: blur(4px); color: var(--active-color); }

    #nav-indicator { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 100; pointer-events: none; }
    .dot { width: 6px; height: 6px; border-radius: 50%; background: rgba(255,255,255,0.2); transition: 0.4s; }
    .dot.active { width: 30px; background: var(--active-color); border-radius: 10px; }

    .text-dynamic { color: var(--active-color); transition: color 1s ease; }
    .border-dynamic { border-color: var(--active-color); transition: border-color 1s ease; }
    
    .orb-wrapper { transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
    .orb-activated .halo { animation: pulse-halo 3s infinite; background: radial-gradient(circle, var(--active-color) 0%, transparent 70%); opacity: 0.2; }
    @keyframes pulse-halo { 0%, 100% { transform: scale(1); opacity: 0.2; } 50% { transform: scale(1.4); opacity: 0.05; } }

    .infodose-voice-btn { transition: all 0.2s; border: 1px solid transparent; opacity: 0.7; }
    .infodose-voice-btn:hover { opacity: 1; background: rgba(255,255,255,0.1); }
    .infodose-voice-btn.selected { border-color: var(--active-color); opacity: 1; background: var(--active-glow); }

    /* Quick Action Button Custom styles */
    #infodose-quick-btn button {
        box-shadow: 0 0 20px var(--active-glow);
        border: 1px solid var(--active-color);
        animation: pulse-button 4s infinite;
    }
    @keyframes pulse-button {
        0%, 100% { transform: scale(1); box-shadow: 0 0 10px var(--active-glow); }
        50% { transform: scale(1.1); box-shadow: 0 0 25px var(--active-glow); }
    }
  </style>
</head>
<body>

  <div id="glow-top" class="ambient-glow"></div>
  <div id="glow-bottom" class="ambient-glow"></div>

  <!-- HEADER -->
  <header class="fixed top-0 left-0 right-0 z-[100] px-8 py-10 flex justify-between items-center pointer-events-none">
    <div class="glass-pill flex items-center gap-3 pointer-events-auto cursor-pointer" onclick="Navigation.to(1)">
      <div id="header-dot" class="w-1.5 h-1.5 rounded-full" style="background: var(--active-color); box-shadow: 0 0 8px var(--active-color); transition: background 1s;"></div>
      <span id="displayUserHeader" class="tracking-widest">USER</span>
    </div>
    <div class="glass-pill pointer-events-auto flex items-center gap-2">
       <span id="displayArchetypeBadge" class="text-dynamic font-black text-[9px]">...</span>
       <span class="text-white/20">|</span>
       <span id="displayInfodoseHeader" class="text-white/40">FUSION OS</span>
    </div>
  </header>

  <div id="universe-viewport">
      
      <!-- SCREEN 0: CORTEX -->
      <section class="screen-panel" id="view-cortex">
          <div class="pt-32 px-8 h-full flex flex-col max-w-4xl mx-auto">
              <div class="flex items-end justify-between mb-10">
                  <div>
                    <h2 class="text-4xl font-black uppercase tracking-tighter leading-none">CÃ³rtex</h2>
                    <p class="text-[10px] text-white/30 uppercase tracking-[0.4em] mt-2 font-bold">Arquivo de ConsciÃªncia</p>
                  </div>
                  <div class="flex gap-8 text-[11px] font-black uppercase tracking-widest">
                      <button onclick="Cortex.switch('crystals')" id="tab-crystals" class="tab-btn active">MemÃ³rias</button>
                      <button onclick="Cortex.switch('matrices')" id="tab-matrices" class="tab-btn">Matrizes</button>
                  </div>
              </div>

              <!-- Crystals Panel -->
              <div id="panel-crystals" class="flex-1 overflow-hidden flex flex-col">
                  <div class="flex gap-4 mb-6">
                      <div class="flex-1 glass-pill flex items-center px-4 py-3 bg-white/5 border-none">
                          <i data-lucide="search" class="w-3.5 h-3.5 text-white/20 mr-3"></i>
                          <input id="memory-search" oninput="Cortex.render()" class="bg-transparent border-none text-xs w-full text-white placeholder-white/20" placeholder="Buscar no subconsciente...">
                      </div>
                      <button onclick="Cortex.openNewMemory()" class="glass-pill bg-white/10 hover:bg-white/20 transition flex items-center gap-2 px-6">
                          <i data-lucide="plus" class="w-3 h-3"></i>
                          <span>Fixar</span>
                      </button>
                  </div>
                  <div id="crystal-container" class="flex-1 overflow-y-auto custom-scroll pr-2 pb-32 space-y-4"></div>
              </div>

              <!-- Matrices Panel -->
              <div id="panel-matrices" class="hidden flex-1 overflow-hidden flex flex-col">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                      <div class="glass-card p-6 flex flex-col justify-between h-40">
                          <p class="text-[10px] text-white/30 uppercase font-black tracking-widest">Status da Matriz</p>
                          <h4 id="active-matrix-name" class="text-xl font-bold text-dynamic">Nenhuma Ativa</h4>
                          <div class="flex gap-2 mt-4">
                              <button onclick="Cortex.importMatrix()" class="glass-pill text-[9px] bg-white/5 border-white/10">Importar .MD</button>
                              <button onclick="Cortex.createNewMatrix()" class="glass-pill text-[9px] bg-active-color/10 text-dynamic border-dynamic/20">Nova Matriz</button>
                          </div>
                      </div>
                      <div class="glass-card p-6 flex flex-col justify-between h-40">
                          <p class="text-[10px] text-white/30 uppercase font-black tracking-widest">Arquivos Locais</p>
                          <div id="matrix-list-mini" class="flex-1 mt-2 overflow-y-auto custom-scroll space-y-2"></div>
                      </div>
                  </div>
                  <div class="flex-1 glass-card p-6 flex flex-col mb-32">
                      <div class="flex justify-between items-center mb-4">
                          <span id="editor-title" class="text-[10px] font-black uppercase tracking-widest text-white/40">Editor de ConsciÃªncia</span>
                          <div class="flex gap-4">
                              <button onclick="Cortex.exportMatrix()" class="text-white/20 hover:text-white transition"><i data-lucide="download" class="w-4 h-4"></i></button>
                              <button onclick="Cortex.saveActiveMatrix()" class="text-dynamic font-black text-[10px] uppercase">Salvar AlteraÃ§Ãµes</button>
                          </div>
                      </div>
                      <textarea id="matrix-editor" class="flex-1 bg-transparent border-none text-sm font-mono text-white/60 resize-none outline-none custom-scroll" placeholder="Escreva aqui as diretrizes da nova matriz..."></textarea>
                  </div>
              </div>
          </div>
      </section>

      <!-- SCREEN 1: NEXUS -->
      <section class="screen-panel" id="view-nexus">
          <div id="nexus-vertical" class="snap-container">
              
              <!-- SECTION 1: ORB & HERO -->
              <div class="snap-section">
                  <div class="text-center mb-12 relative z-20">
                      <h1 id="hero-title" class="text-7xl font-black tracking-tighter mb-4 bg-clip-text text-transparent bg-gradient-to-b from-white to-white/20 transition-all duration-1000">NEXUS</h1>
                      <div id="nexus-status" class="flex items-center justify-center gap-3">
                          <span class="w-10 h-[1px] bg-white/10"></span>
                          <p id="archetype-status-text" class="text-[10px] uppercase tracking-[0.6em] text-white/30 font-light text-dynamic">EquilÃ­brio Ativo</p>
                          <span class="w-10 h-[1px] bg-white/10"></span>
                      </div>
                  </div>

                  <!-- ORB -->
                  <div id="orbClickable" class="relative group cursor-grab active:cursor-grabbing p-16 transition-all duration-700"
                       onmousedown="OrbDrag.start(event)" ontouchstart="OrbDrag.start(event)">
                      <div class="orb-wrapper relative" id="orbContainer">
                          <div class="halo absolute -inset-10 rounded-full blur-2xl transition-all duration-700"></div>
                          <div class="relative z-10 flex items-center justify-center">
                              <svg width="220" height="220" viewBox="0 0 200 200">
                                  <defs>
                                      <linearGradient id="orbGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                          <stop offset="0%" stop-color="#fff" stop-opacity="0.8"/>
                                          <stop offset="100%" stop-color="#fff" stop-opacity="0.2"/>
                                      </linearGradient>
                                  </defs>
                                  <circle cx="100" cy="100" r="85" stroke="url(#orbGrad)" stroke-width="1.5" fill="none" opacity="0.3"/>
                                  <circle cx="100" cy="100" r="60" stroke="url(#orbGrad)" stroke-width="0.5" fill="none" opacity="0.1"/>
                                  <path d="M100 15 A85 85 0 0 0 100 185" stroke="url(#orbGrad)" stroke-width="4" fill="none" stroke-linecap="round"/>
                                  <circle cx="100" cy="100" r="10" fill="var(--active-color)" class="shadow-lg transition-colors duration-1000"/>
                              </svg>
                          </div>
                      </div>
                  </div>

                  <div class="absolute bottom-24 text-center space-y-2 opacity-30 pointer-events-none">
                      <p class="text-[9px] uppercase tracking-[0.4em] font-bold">Role para acessar</p>
                      <div class="flex justify-center flex-col items-center gap-1 animate-bounce">
                          <i data-lucide="chevron-down" class="w-4 h-4 text-dynamic"></i>
                      </div>
                  </div>
              </div>

              <!-- SECTION 2: STATUS -->
              <div class="snap-section px-8">
                  <div class="max-w-4xl w-full">
                    <h3 class="text-2xl font-black uppercase tracking-tighter mb-8 flex items-center gap-3">
                        <i data-lucide="zap" class="w-5 h-5 text-dynamic"></i>
                        Sinais <span class="text-dynamic" id="cards-archetype-name">...</span>
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="glass-card p-6 hover:bg-white/5 transition border border-white/5 hover:border-dynamic/30">
                            <i data-lucide="heart" class="w-6 h-6 mb-4 text-white/40"></i>
                            <div class="text-[10px] uppercase font-bold text-white/30">FrequÃªncia</div>
                            <div class="text-lg font-bold mt-1">Favoritos</div>
                        </div>
                        <div class="glass-card p-6 hover:bg-white/5 transition border border-white/5 hover:border-dynamic/30 bg-active-color/5">
                            <i data-lucide="user" class="w-6 h-6 mb-4 text-dynamic"></i>
                            <div class="text-[10px] uppercase font-bold text-white/30">Meu Card</div>
                            <div class="text-lg font-bold mt-1 text-dynamic">Ativo</div>
                        </div>
                        <div class="glass-card p-6 hover:bg-white/5 transition border border-white/5 hover:border-dynamic/30">
                            <i data-lucide="bar-chart-2" class="w-6 h-6 mb-4 text-white/40"></i>
                            <div class="text-[10px] uppercase font-bold text-white/30">NÃ­vel</div>
                            <div class="text-lg font-bold mt-1">Sincronizado</div>
                        </div>
                        <div class="glass-card p-6 hover:bg-white/5 transition border border-white/5 hover:border-dynamic/30">
                            <i data-lucide="radio" class="w-6 h-6 mb-4 text-white/40"></i>
                            <div class="text-[10px] uppercase font-bold text-white/30">Sinal</div>
                            <div class="text-lg font-bold mt-1">EstÃ¡vel</div>
                        </div>
                    </div>
                  </div>
              </div>

              <!-- SECTION 3: DR. K / DYNAMIC -->
              <div class="snap-section px-8">
                  <div class="max-w-4xl w-full flex flex-col justify-center h-full">
                      <h2 class="text-sm uppercase tracking-[0.2em] text-white/40 font-bold mb-6">Curadoria Dr. K</h2>
                      
                      <div class="glass-card p-8 mb-8 border-l-4 border-dynamic">
                        <p id="drk-line" class="text-xl md:text-2xl font-light italic text-white/90 leading-relaxed">
                          "O sistema responde ao silÃªncio. Respire antes de reagir."
                        </p>
                        <p class="text-[10px] uppercase tracking-widest text-dynamic mt-4 text-right">â€” Insight do ArquÃ©tipo</p>
                      </div>

                      <div id="archetype-video-suggestion" class="w-full aspect-video rounded-3xl bg-white/5 border border-white/10 flex items-center justify-center overflow-hidden relative group cursor-pointer shadow-2xl">
                           <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
                               <span class="text-xs uppercase tracking-widest animate-pulse">Sintonizando...</span>
                           </div>
                      </div>
                  </div>
              </div>

          </div>
      </section>

      <!-- SCREEN 2: DUALTUBE -->
      <section class="screen-panel custom-scroll overflow-y-auto bg-[#020202]" id="view-dualtube">
          <div class="pt-32 px-8 h-full flex flex-col pb-40">
              <div class="mb-12 flex justify-between items-end">
                <div>
                    <h2 class="text-4xl font-black text-white tracking-tighter uppercase">DualTube</h2>
                    <p class="text-[10px] text-dynamic uppercase tracking-[0.4em] font-bold mt-2">Curadoria de Sinais</p>
                </div>
                <div class="text-right">
                    <span id="dt-watched-count" class="text-3xl font-black text-white/10">0</span>
                    <p class="text-[8px] uppercase text-white/20 font-bold tracking-widest">VÃ­deos</p>
                </div>
              </div>
              <div id="video-categories" class="space-y-16"></div>
          </div>
      </section>
      
  </div>

  <!-- NAVIGATION DOTS -->
  <div id="nav-indicator">
      <div class="dot" id="dot-0"></div>
      <div class="dot active" id="dot-1"></div>
      <div class="dot" id="dot-2"></div>
  </div>

  <!-- MODALS & OVERLAYS -->
  <div id="modal-overlay" class="fixed inset-0 z-[500] bg-black/80 backdrop-blur-xl hidden flex items-center justify-center p-6">
      <div id="modal-content" class="w-full max-w-lg glass-card p-8 scale-90 opacity-0 transition-all duration-300"></div>
  </div>

  <div id="player-overlay" class="fixed inset-0 z-[1000] bg-black hidden flex-col">
      <div class="p-8 flex justify-between items-center">
          <div class="flex flex-col">
              <span class="text-[10px] text-dynamic font-black uppercase tracking-widest">SessÃ£o Ativa</span>
              <span id="playing-title" class="text-sm font-bold text-white/60">DualTube Stream</span>
          </div>
          <button onclick="closePlayer()" class="glass-pill border-red-500/20 text-red-500 hover:bg-red-500/10">Encerrar</button>
      </div>
      <div class="flex-1 flex items-center justify-center p-6">
          <div id="yt-embed" class="w-full max-w-6xl aspect-video rounded-3xl overflow-hidden shadow-2xl border border-white/5 bg-[#050505]"></div>
      </div>
  </div>

  <div id="di_toast" class="fixed bottom-32 left-1/2 -translate-x-1/2 z-[2000] pointer-events-none flex flex-col gap-2"></div>

  <script>
    /* ========== STATE & CONFIG ========== */
    const KEYS = {
        CORTEX: 'di_cortex_v23', 
        USER: 'di_userName',
        ARCHETYPE: 'di_activeArchetype',
        STATS: 'di_videoStats',
        TRAIN_TXT: 'di_trainingText'
    };

    const ARCHETYPES_DB = {
      "ATLAS": { id: "atlas", name: "Atlas", desc: "Estrutura & Governo", colors: { main: "#38BDF8", soft: "rgba(56,189,248,0.18)", secondary: "#0EA5E9" }, drk: "A ordem externa reflete a clareza interna. Construa.", vid: "Bt_rLbMjJDk" },
      "NOVA": { id: "nova", name: "Nova", desc: "InovaÃ§Ã£o & Fluxo", colors: { main: "#F97316", soft: "rgba(249,115,22,0.18)", secondary: "#FDBA74" }, drk: "O erro Ã© apenas um dado nÃ£o processado. Itere.", vid: "qldgs0aLdB0" },
      "VITALIS": { id: "vitalis", name: "Vitalis", desc: "Energia & AÃ§Ã£o", colors: { main: "#22C55E", soft: "rgba(34,197,94,0.18)", secondary: "#4ADE80" }, drk: "O corpo sabe antes da mente duvidar. Mova-se.", vid: "_0wVkryxanE" },
      "PULSE": { id: "pulse", name: "Pulse", desc: "Ritmo & EmoÃ§Ã£o", colors: { main: "#EC4899", soft: "rgba(236,72,153,0.18)", secondary: "#F9A8D4" }, drk: "Sinta a batida do caos e dance com ela.", vid: "Id2NI9tv1r4" },
      "ARTEMIS": { id: "artemis", name: "Artemis", desc: "Foco & CaÃ§a", colors: { main: "#A855F7", soft: "rgba(168,85,247,0.18)", secondary: "#C4B5FD" }, drk: "Defina o alvo. O resto Ã© apenas ruÃ­do.", vid: "FbutKMpd8MY" },
      "SERENA": { id: "serena", name: "Serena", desc: "Paz & Harmonia", colors: { main: "#06B6D4", soft: "rgba(6,182,212,0.14)", secondary: "#E0F2FE" }, drk: "No centro do furacÃ£o, existe um ponto imÃ³vel. Seja ele.", vid: "hfQ1L6fCfAo" },
      "KAOS": { id: "kaos", name: "Kaos", desc: "MudanÃ§a & Entropia", colors: { main: "#FACC15", soft: "rgba(250,204,21,0.18)", secondary: "#FDE68A" }, drk: "Quebre o padrÃ£o hoje. AmanhÃ£ nasce o novo.", vid: "Tq99vQNQ6dQ" },
      "GENUS": { id: "genus", name: "Genus", desc: "CriaÃ§Ã£o & Arte", colors: { main: "#E5E7EB", soft: "rgba(229,231,235,0.12)", secondary: "#9CA3AF" }, drk: "A excelÃªncia habita nos detalhes que ninguÃ©m vÃª.", vid: "DTDfkHwuMic" },
      "LUMINE": { id: "lumine", name: "Lumine", desc: "Brilho & Carisma", colors: { main: "#FDE047", soft: "rgba(253,224,71,0.18)", secondary: "#FACC15" }, drk: "Irradie sem medo. A sombra Ã© apenas falta de luz.", vid: "1L9_rFmIGJ8" },
      "SOLUS": { id: "solus", name: "Solus", desc: "Vazio & Verdade", colors: { main: "#0EA5E9", soft: "rgba(14,165,233,0.20)", secondary: "#0369A1" }, drk: "O silÃªncio revela mais que mil estÃ­mulos.", vid: "qldgs0aLdB0" },
      "RHEA": { id: "rhea", name: "Rhea", desc: "Cuidado & Raiz", colors: { main: "#10B981", soft: "rgba(16,185,129,0.16)", secondary: "#065F46" }, drk: "Nutra a raiz e o fruto virÃ¡ naturalmente.", vid: "Bt_rLbMjJDk" },
      "HORUS": { id: "horus", name: "Horus", desc: "VisÃ£o & EstratÃ©gia", colors: { main: "#6366F1", soft: "rgba(99,102,241,0.20)", secondary: "#312E81" }, drk: "Observe o todo antes de agir no detalhe.", vid: "_0wVkryxanE" },
      "AION": { id: "aion", name: "Aion", desc: "Tempo & EvoluÃ§Ã£o", colors: { main: "#4F46E5", soft: "rgba(79,70,229,0.20)", secondary: "#A5B4FC" }, drk: "O tempo nÃ£o Ã© linear. O agora Ã© eterno.", vid: "Id2NI9tv1r4" }
    };

    let STATE = {
        screen: 1,
        cortex: { crystals: [], matrices: [] },
        activePanel: 'crystals',
        editingMatrixId: null,
        currentArchetype: 'VITALIS' 
    };

    /* ========== INITIALIZATION ========== */
    window.onload = () => {
        lucide.createIcons();
        loadSystem();
        setupNavigation();
        ArchetypeSystem.init();
        Cortex.render();
        DualTube.render();
        Navigation.to(1);
    };

    function loadSystem() {
        const saved = localStorage.getItem(KEYS.CORTEX);
        if (saved) {
            STATE.cortex = JSON.parse(saved);
        } else {
            STATE.cortex = {
                crystals: [
                    { id: 1, content: "O equilÃ­brio precede a performance.", tags: ["filosofia"], archetype: "VITALIS", pinned: true }
                ],
                matrices: [
                    { id: 'm1', name: 'Treino PrimÃ¡rio', content: '# Matriz Alpha\n\nFoco total na execuÃ§Ã£o.', active: true }
                ]
            };
            saveCortex();
        }
        document.getElementById('displayUserHeader').innerText = localStorage.getItem(KEYS.USER) || 'PILOTO';
    }

    function saveCortex() {
        localStorage.setItem(KEYS.CORTEX, JSON.stringify(STATE.cortex));
    }

    /* ========== ARCHETYPE SYSTEM (UNIFIED BRAIN) ========== */
    const ArchetypeSystem = {
        init: () => {
            const saved = localStorage.getItem(KEYS.ARCHETYPE);
            ArchetypeSystem.set(saved && ARCHETYPES_DB[saved] ? saved : 'VITALIS');
        },

        set: (key) => {
            const data = ARCHETYPES_DB[key];
            if(!data) return;
            STATE.currentArchetype = key;
            localStorage.setItem(KEYS.ARCHETYPE, key);
            
            // Visual Engine
            document.documentElement.style.setProperty('--active-color', data.colors.main);
            document.documentElement.style.setProperty('--active-glow', data.colors.soft);
            document.documentElement.style.setProperty('--accent-secondary', data.colors.secondary);

            // UI Elements
            document.getElementById('displayArchetypeBadge').innerText = key;
            document.getElementById('archetype-status-text').innerText = data.desc;
            document.getElementById('cards-archetype-name').innerText = key;
            document.getElementById('hero-title').innerText = key;
            document.getElementById('drk-line').innerText = `"${data.drk}"`;

            // Dynamic Recommendation
            const vidContainer = document.getElementById('archetype-video-suggestion');
            vidContainer.onclick = () => playVideo(data.vid, `Sintoniza: ${key}`);
            vidContainer.innerHTML = `
                <img src="https://img.youtube.com/vi/${data.vid}/mqdefault.jpg" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition duration-500 transform group-hover:scale-105">
                <div class="absolute inset-0 bg-black/20 flex flex-col items-center justify-center backdrop-blur-[2px] group-hover:backdrop-blur-none transition">
                    <i data-lucide="play-circle" class="w-12 h-12 text-white/80 group-hover:text-dynamic transition"></i>
                    <span class="mt-2 text-[10px] uppercase tracking-widest font-bold">RecomendaÃ§Ã£o ${key}</span>
                </div>
            `;
            
            // Re-render context-sensitive UI
            Cortex.render();
            lucide.createIcons();
        }
    };

    /* ========== NAVIGATION ENGINE ========== */
    const Navigation = {
        to: (idx) => {
            STATE.screen = idx;
            document.getElementById('universe-viewport').style.transform = `translateX(-${idx * 100}vw)`;
            [0,1,2].forEach(i => document.getElementById(`dot-${i}`)?.classList.toggle('active', i === idx));
            
            const colors = ['#a855f7', getComputedStyle(document.documentElement).getPropertyValue('--active-color'), '#3b82f6'];
            document.getElementById('glow-top').style.background = colors[idx] || colors[1];
        }
    };

    function setupNavigation() {
        let tsX = 0, tsY = 0;
        document.addEventListener('touchstart', e => { tsX = e.touches[0].clientX; tsY = e.touches[0].clientY; }, {passive:true});
        document.addEventListener('touchend', e => {
            const dX = tsX - e.changedTouches[0].clientX, dY = tsY - e.changedTouches[0].clientY;
            if(Math.abs(dX) > 80 && Math.abs(dX) > Math.abs(dY)) {
                if(dX > 0 && STATE.screen < 2) Navigation.to(STATE.screen + 1);
                else if(dX < 0 && STATE.screen > 0) Navigation.to(STATE.screen - 1);
            }
        }, {passive:true});
    }

    const OrbDrag = {
        active: false, startX: 0, el: null,
        start: function(e) { 
            this.active = true; 
            this.startX = e.type.includes('mouse')?e.clientX:e.touches[0].clientX; 
            this.el = document.getElementById('orbContainer');
            const move = (ev) => this.move(ev);
            const end = () => { this.end(); window.removeEventListener('mousemove', move); window.removeEventListener('mouseup', end); window.removeEventListener('touchmove', move); window.removeEventListener('touchend', end); };
            window.addEventListener('mousemove', move); window.addEventListener('mouseup', end);
            window.addEventListener('touchmove', move, {passive:false}); window.addEventListener('touchend', end);
        },
        move: function(e) {
            if(!this.active) return;
            const x = e.type.includes('mouse')?e.clientX:e.touches[0].clientX;
            const diff = x - this.startX;
            this.el.style.transform = `translateX(${diff/4}px) rotate(${diff/20}deg)`; 
        },
        end: function() {
            if(!this.active) return; this.active = false;
            const matrix = new WebKitCSSMatrix(window.getComputedStyle(this.el).transform);
            if(matrix.m41 > 70 && STATE.screen > 0) Navigation.to(STATE.screen - 1);
            else if(matrix.m41 < -70 && STATE.screen < 2) Navigation.to(STATE.screen + 1);
            this.el.style.transform = 'translateX(0) rotate(0)';
        }
    };

    /* ========== CORTEX LOGIC ========== */
    const Cortex = {
        switch: (tab) => {
            STATE.activePanel = tab;
            document.getElementById('panel-crystals').classList.toggle('hidden', tab !== 'crystals');
            document.getElementById('panel-matrices').classList.toggle('hidden', tab !== 'matrices');
            document.getElementById('tab-crystals').classList.toggle('active', tab === 'crystals');
            document.getElementById('tab-matrices').classList.toggle('active', tab === 'matrices');
            Cortex.render();
        },
        render: () => (STATE.activePanel === 'crystals' ? Cortex.renderCrystals() : Cortex.renderMatrices()),
        renderCrystals: () => {
            const container = document.getElementById('crystal-container'), query = document.getElementById('memory-search').value.toLowerCase();
            const filtered = STATE.cortex.crystals.filter(c => c.content.toLowerCase().includes(query) || (c.tags?.some(t => t.toLowerCase().includes(query)))).sort((a,b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0));
            container.innerHTML = filtered.map(c => {
                const arch = ARCHETYPES_DB[c.archetype] || ARCHETYPES_DB['VITALIS'];
                return `
                <div class="memory-card p-6 ${c.pinned ? 'pinned' : ''}">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex gap-2 flex-wrap">
                            ${(c.tags||[]).map(t => `<span class="tag-bubble">${t}</span>`).join('')}
                            <span class="tag-bubble border-dynamic/30" style="color:${arch.colors.main}; border-color:${arch.colors.main}">${c.archetype}</span>
                        </div>
                        <div class="flex gap-3 opacity-20 hover:opacity-100 transition">
                            <button onclick="Cortex.togglePin(${c.id})"><i data-lucide="pin" class="w-3.5 h-3.5 ${c.pinned ? 'text-dynamic fill-current' : ''}"></i></button>
                            <button onclick="Cortex.deleteMemory(${c.id})"><i data-lucide="trash-2" class="w-3.5 h-3.5 text-red-500"></i></button>
                        </div>
                    </div>
                    <p class="text-sm leading-relaxed text-white/80 font-medium italic">"${c.content}"</p>
                </div>`;
            }).join('') || `<p class="text-center text-white/10 py-20 text-xs uppercase tracking-widest">SilÃªncio no Subconsciente</p>`;
            lucide.createIcons();
        },
        renderMatrices: () => {
            const list = document.getElementById('matrix-list-mini'), activeM = STATE.cortex.matrices.find(m => m.active);
            document.getElementById('active-matrix-name').innerText = activeM ? activeM.name : 'Nenhuma Ativa';
            list.innerHTML = STATE.cortex.matrices.map(m => `
                <div onclick="Cortex.loadToEditor('${m.id}')" class="matrix-item p-3 flex justify-between items-center cursor-pointer ${m.active ? 'active' : ''}">
                    <span class="text-[10px] font-bold uppercase tracking-widest ${m.active ? 'text-dynamic' : 'text-white/40'}">${m.name}</span>
                    <div class="flex gap-2">
                        ${m.active ? '<span class="w-1.5 h-1.5 rounded-full bg-active-color shadow-[0_0_8px_var(--active-color)]"></span>' : ''}
                        <button onclick="Cortex.deleteMatrix('${m.id}', event)" class="text-white/10 hover:text-red-500"><i data-lucide="x" class="w-3 h-3"></i></button>
                    </div>
                </div>`).join('');
            if (!STATE.editingMatrixId && activeM) Cortex.loadToEditor(activeM.id);
            lucide.createIcons();
        },
        openNewMemory: () => Modal.show(`
            <h3 class="text-xl font-black uppercase mb-6 tracking-tight text-dynamic">Cristalizar Fato</h3>
            <textarea id="new-mem-txt" class="w-full h-32 bg-white/5 rounded-2xl p-4 border border-white/10 text-sm outline-none focus:border-dynamic mb-4" placeholder="O que deseja fixar no subconsciente?"></textarea>
            <input id="new-mem-tags" class="w-full bg-white/5 rounded-xl p-3 border border-white/10 text-xs mb-6" placeholder="Tags (ex: foco, hÃ¡bito, estudo)">
            <div class="flex justify-end gap-3">
                <button onclick="Modal.hide()" class="text-xs uppercase font-bold text-white/30">Voltar</button>
                <button onclick="Cortex.saveNewMemory()" class="glass-pill bg-active-color/20 text-dynamic border-dynamic">Cristalizar</button>
            </div>`),
        saveNewMemory: () => {
            const content = document.getElementById('new-mem-txt').value, tags = document.getElementById('new-mem-tags').value.split(',').map(t => t.trim()).filter(t => t);
            if(!content) return;
            STATE.cortex.crystals.unshift({ id: Date.now(), content, tags, archetype: STATE.currentArchetype, pinned: false });
            saveCortex(); Cortex.render(); Modal.hide(); toast("MemÃ³ria sincronizada");
        },
        togglePin: (id) => { const m = STATE.cortex.crystals.find(c => c.id === id); if(m) m.pinned = !m.pinned; saveCortex(); Cortex.render(); },
        deleteMemory: (id) => { STATE.cortex.crystals = STATE.cortex.crystals.filter(c => c.id !== id); saveCortex(); Cortex.render(); },
        loadToEditor: (id) => {
            const m = STATE.cortex.matrices.find(mx => mx.id === id);
            if(!m) return; STATE.editingMatrixId = id;
            document.getElementById('editor-title').innerText = `Editando: ${m.name}`;
            document.getElementById('matrix-editor').value = m.content;
            Cortex.renderMatrices();
        },
        createNewMatrix: () => {
            const name = prompt("Nome da matriz:");
            if(!name) return;
            const newM = { id: 'm' + Date.now(), name, content: '', active: false };
            STATE.cortex.matrices.push(newM); saveCortex(); Cortex.loadToEditor(newM.id);
        },
        saveActiveMatrix: () => {
            const m = STATE.cortex.matrices.find(mx => mx.id === STATE.editingMatrixId);
            if(!m) return;
            m.content = document.getElementById('matrix-editor').value;
            if(!STATE.cortex.matrices.find(x => x.active)) m.active = true;
            saveCortex(); 
            if(m.active) localStorage.setItem(KEYS.TRAIN_TXT, m.content);
            toast("Matriz salva e ativada");
        },
        importMatrix: () => {
            const inp = document.createElement('input'); inp.type = 'file'; inp.accept = '.md,.txt';
            inp.onchange = e => {
                const file = e.target.files[0], reader = new FileReader();
                reader.onload = (ev) => {
                    STATE.cortex.matrices.push({ id: 'm' + Date.now(), name: file.name.replace('.md', ''), content: ev.target.result, active: false });
                    saveCortex(); Cortex.renderMatrices(); toast("Matriz importada");
                };
                reader.readAsText(file);
            };
            inp.click();
        },
        deleteMatrix: (id, e) => {
            e.stopPropagation();
            if(STATE.cortex.matrices.length <= 1) return toast("Matriz mÃ­nima necessÃ¡ria");
            STATE.cortex.matrices = STATE.cortex.matrices.filter(m => m.id !== id);
            if(STATE.editingMatrixId === id) STATE.editingMatrixId = null;
            saveCortex(); Cortex.renderMatrices();
        }
    };

    /* ========== DUALTUBE ENGINE ========== */
    const DualTube = {
        data: [
            { cat: 'FrequÃªncias e Rituais', vids: ["Bt_rLbMjJDk", "_0wVkryxanE", "Id2NI9tv1r4"], desc: 'AmbientaÃ§Ã£o e AtivaÃ§Ã£o' },
            { cat: 'Arquitetura Cognitiva', vids: ["qldgs0aLdB0", "FbutKMpd8MY", "1L9_rFmIGJ8"], desc: 'Foco e Subconsciente' },
            { cat: 'MeditaÃ§Ãµes Profundas', vids: ["hfQ1L6fCfAo", "Tq99vQNQ6dQ", "DTDfkHwuMic"], desc: 'Deriva e SilÃªncio' }
        ],
        render: () => {
            const container = document.getElementById('video-categories'), stats = JSON.parse(localStorage.getItem(KEYS.STATS) || '{}');
            container.innerHTML = DualTube.data.map(c => `
                <div class="space-y-6">
                    <div>
                        <h4 class="text-sm font-black uppercase tracking-[0.3em] text-white/80">${c.cat}</h4>
                        <p class="text-[9px] text-white/20 uppercase tracking-[0.2em] mt-1">${c.desc}</p>
                    </div>
                    <div class="video-row">
                        ${c.vids.map(id => `
                            <div onclick="playVideo('${id}', '${c.cat}')" class="video-card glass-card group cursor-pointer active:scale-95 transition duration-500 ${stats[id] ? 'border-dynamic/20' : ''}">
                                ${stats[id] ? '<div class="played-badge">VISTO</div>' : ''}
                                <img src="https://img.youtube.com/vi/${id}/mqdefault.jpg" class="w-full h-32 object-cover opacity-60 group-hover:opacity-100 transition">
                                <div class="p-4 bg-black/40 backdrop-blur-md flex items-center justify-between">
                                    <span class="text-[9px] font-black uppercase text-white/40 tracking-widest">Sintonizar</span>
                                    <i data-lucide="play" class="w-3 h-3 text-dynamic"></i>
                                </div>
                            </div>`).join('')}
                    </div>
                </div>`).join('');
            document.getElementById('dt-watched-count').innerText = Object.keys(stats).length;
            lucide.createIcons();
        }
    };

    function playVideo(id, cat) {
        document.getElementById('player-overlay').classList.replace('hidden', 'flex');
        document.getElementById('playing-title').innerText = cat;
        document.getElementById('yt-embed').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1&modestbranding=1&rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        let stats = JSON.parse(localStorage.getItem(KEYS.STATS) || '{}');
        stats[id] = { ts: Date.now(), cat };
        localStorage.setItem(KEYS.STATS, JSON.stringify(stats));
        DualTube.render();
    }
    function closePlayer() { document.getElementById('player-overlay').classList.replace('flex', 'hidden'); document.getElementById('yt-embed').innerHTML = ''; }

    /* ========== MODAL & UI UTILS ========== */
    const Modal = {
        show: (html) => {
            const overlay = document.getElementById('modal-overlay'), content = document.getElementById('modal-content');
            content.innerHTML = html; overlay.classList.replace('hidden', 'flex');
            setTimeout(() => { content.classList.replace('scale-90', 'scale-100'); content.classList.replace('opacity-0', 'opacity-100'); }, 10);
            lucide.createIcons();
        },
        hide: () => {
            const overlay = document.getElementById('modal-overlay'), content = document.getElementById('modal-content');
            content.classList.replace('scale-100', 'scale-90'); content.classList.replace('opacity-100', 'opacity-0');
            setTimeout(() => overlay.classList.replace('flex', 'hidden'), 300);
        }
    };

    function toast(m, time = 2500) {
        const t = document.getElementById('di_toast'), d = document.createElement('div');
        d.className = "glass-pill bg-black/90 border-dynamic px-8 py-3 shadow-2xl backdrop-blur-xl text-[10px] font-black uppercase tracking-widest text-center animate-bounce";
        d.style.color = "var(--active-color)"; d.innerText = m;
        t.appendChild(d);
        setTimeout(() => { d.style.opacity = '0'; setTimeout(() => d.remove(), 500); }, time);
    }

    /* ========== INFODOSE INTEGRATION PATCH ========== */
    const INFODOSE_MICRO_SCRIPTS = {
        ATLAS: { open: "Erga-se. A estrutura do seu impÃ©rio comeÃ§a agora.", ritual: "Visualize uma coluna de luz sustentando suas costas." },
        NOVA: { open: "E aÃ­! O universo tÃ¡ cheio de glitches esperando nossa correÃ§Ã£o.", ritual: "Estale os dedos trÃªs vezes e sorria para o nada." },
        VITALIS: { open: "Sem hesitaÃ§Ã£o. O tempo Ã© agora e a energia estÃ¡ no pico.", ritual: "TrÃªs respiraÃ§Ãµes explosivas. Acorde o sangue." },
        PULSE: { open: "Sente o ritmo? O dia jÃ¡ comeÃ§ou a tocar nossa mÃºsica.", ritual: "Encontre a batida do seu coraÃ§Ã£o e sincronize." },
        ARTEMIS: { open: "Curso traÃ§ado. O horizonte nos chama.", ritual: "Foque no ponto mais distante que conseguir ver." },
        LUMINE: { open: "Olha quanto brilho! Vamos iluminar cada canto escuro.", ritual: "Imagine luz dourada preenchendo a sala." },
        SERENA: { open: "Calma. O mundo lÃ¡ fora gira, mas aqui dentro hÃ¡ paz.", ritual: "MÃ£o no peito, sinta a quietude." },
        KAOS: { open: "Quebre o padrÃ£o. A ordem Ã© sÃ³ uma ilusÃ£o.", ritual: "FaÃ§a um movimento brusco e inesperado." },
        GENUS: { open: "PrecisÃ£o. Cada detalhe importa na obra que somos.", ritual: "Observe texturas de um objeto por 10s." },
        RHEA: { open: "Bem-vindo. O dia te recebe com um abraÃ§o suave.", ritual: "Abrace a si mesmo por um instante." },
        SOLUS: { open: "No vazio, a verdade ecoa. Escute o silÃªncio.", ritual: "Escute o som ambiente por 30 segundos." },
        HORUS: { open: "VisÃ£o panorÃ¢mica ativada. Executar estratÃ©gia.", ritual: "Visualize seu dia inteiro em um segundo." },
        AION: { open: "O tempo Ã© relativo. Vamos moldar o agora.", ritual: "Visualize o futuro como uma memÃ³ria real." }
    };

    function applyInfodoseTraining() {
        let txt = `MATRIZ INFODOSE v23\n\n-- SCRIPTS DE VOZ --\n`;
        Object.keys(INFODOSE_MICRO_SCRIPTS).forEach(k => txt += `[${k}] Abertura: "${INFODOSE_MICRO_SCRIPTS[k].open}"\n`);
        localStorage.setItem(KEYS.TRAIN_TXT, txt);
        const script = INFODOSE_MICRO_SCRIPTS[STATE.currentArchetype];
        navigator.clipboard.writeText(`[ATIVAR: ${STATE.currentArchetype}]\n[SCRIPT]: ${script.open}`);
        toast(`Treino ${STATE.currentArchetype} aplicado`);
    }

    function showInfodoseModal() {
        Modal.show(`
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-xl font-black text-white">Matriz Infodose</h3>
                    <p class="text-[9px] text-white/40 uppercase tracking-widest mt-1">SincronizaÃ§Ã£o de Voz Ativa</p>
                </div>
                <button onclick="applyInfodoseTraining()" class="glass-pill bg-active-color/10 text-dynamic border-dynamic">Injetar Treino</button>
            </div>
            <div class="grid grid-cols-4 gap-2 mb-6">
                ${Object.keys(ARCHETYPES_DB).map(k => `
                    <button onclick="ArchetypeSystem.set('${k}'); showInfodoseModal();" class="glass-pill text-[8px] text-center p-2 ${k===STATE.currentArchetype?'bg-active-color/20 text-dynamic border-dynamic':'opacity-40'}">${k}</button>
                `).join('')}
            </div>
            <div class="bg-black/40 p-4 rounded-xl font-mono text-[10px] text-white/60 h-40 overflow-y-auto custom-scroll border border-white/5">
                ${STATE.currentArchetype} selecionado. <br>Script de abertura: "${INFODOSE_MICRO_SCRIPTS[STATE.currentArchetype].open}"<br><br>
                Matriz de comportamento: ${ARCHETYPES_DB[STATE.currentArchetype].desc}.
            </div>
        `);
    }

    /* Create Floating Quick Access */
    (function createInfodoseButton() {

const btn = document.createElement('div');
btn.id = 'infodose-quick-btn';
btn.className = `
  fixed 
  top-[calc(env(safe-area-inset-top,0px)+24px)]
  right-3
  z-[999]
  transition-all duration-300
  opacity-1
`;

btn.innerHTML = `
  <button onclick="showInfodoseModal()"
    class="
      bg-black/40 backdrop-blur-md
      w-7 h-7           /* tamanho real: 28px */
      flex items-center justify-center
      text-[12px]       /* controla o tamanho do ðŸ’Š */
      rounded-full
      opacity-60
      hover:opacity-100
      active:scale-95
      transition
    ">
    ðŸ’Š
  </button>
`;

document.body.appendChild(btn);

// animaÃ§Ã£o de entrada suave (cinematogrÃ¡fica)
requestAnimationFrame(() => {
  btn.classList.remove('opacity-0', 'translate-y-[-6px]');
  btn.classList.add('opacity-100', 'translate-y-0');
});

document.body.appendChild(btn);

        document.body.appendChild(btn);
    })();

  </script>
</body>
</html>

