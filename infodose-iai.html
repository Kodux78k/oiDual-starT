<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Infodose â€” Biohacking Neural</title>

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3062/3062125.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --bg:#000;
      --accent:#fff;
      --glass:rgba(255,255,255,0.04);
      --glass-2:rgba(255,255,255,0.06);
      --muted:rgba(255,255,255,0.48);
      --pill-radius:28px;
    }

    * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; outline:none; }
    html,body { height:100%; margin:0; background:var(--bg); color:#fff; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Segoe UI,Roboto,Helvetica,Arial; -webkit-font-smoothing:antialiased; overflow: hidden; }

    .snap-container {
      height:100vh;
      overflow-y:auto;
      scroll-snap-type:y mandatory;
      scroll-behavior: smooth;
    }
    section.page {
      min-height:100vh;
      scroll-snap-align:start;
      display:flex;
      flex-direction: column;
      align-items:center;
      justify-content:center;
      padding:2rem;
      position: relative;
    }

    .glass-pill { background:var(--glass); backdrop-filter:blur(24px); -webkit-backdrop-filter:blur(24px); border-radius:var(--pill-radius); border:1px solid rgba(255,255,255,0.08); transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    .glass-pill:active { transform:scale(.97); background: rgba(255,255,255,0.1); }

    .btn-card { display:flex; align-items:center; gap:16px; padding:16px; border-radius:20px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.05); cursor:pointer; width:100%; transition: all 0.3s; }
    .btn-card:hover { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.1); }
    .btn-icon { width:52px; height:52px; border-radius:14px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }

    .management-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; max-width: 400px; }
    .mng-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 20px; border-radius: 20px; background: var(--glass); border: 1px solid rgba(255,255,255,0.05); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); }
    .mng-btn:active { background: rgba(255,255,255,0.1); color: #fff; }

    .dash-card { background: rgba(10,10,10,0.5); border: 1px solid rgba(255,255,255,0.04); border-radius: 24px; padding: 20px; width: 100%; max-width: 500px; }
    .log-list { max-height: 200px; overflow-y: auto; padding-right: 8px; }
    .log-item { padding: 12px; border-radius: 12px; background: rgba(255,255,255,0.02); margin-bottom: 8px; border-left: 2px solid #3b82f6; font-size: 11px; line-height: 1.4; }
    
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

    #active-ui { position:fixed; inset:0; z-index:100; display:none; flex-direction:column; align-items:center; justify-content:center; background:rgba(0,0,0,0.95); backdrop-filter: blur(10px); }
    #active-ui.visible { display:flex; animation: fadeIn 0.4s forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .acc-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
    .acc-content.open { max-height: 300px; }

    #top-bar { position:fixed; top:0; left:0; right:0; z-index:80; padding: 16px; display:flex; justify-content:space-between; pointer-events:none; }
    .panel-pill { pointer-events:auto; padding: 8px 14px; background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; display: flex; align-items: center; gap: 8px; cursor: pointer; }
  </style>
</head>
<body>

  <!-- Top HUD -->
  <div id="top-bar">
    <div class="panel-pill" onclick="restoreActiveUI()">
      <div id="status-dot" class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981]"></div>
      <span id="displayUser" class="text-[10px] font-bold tracking-widest uppercase">Syncing...</span>
      <span id="active-tag" class="hidden text-[8px] bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded ml-1 animate-pulse">ACTIVE</span>
    </div>
    <div class="panel-pill">
      <i data-lucide="cpu" class="w-3 opacity-40"></i>
      <input id="id_modelName" type="text" placeholder="MODEL_ID" class="bg-transparent border-none text-[10px] w-24 focus:ring-0 text-white font-mono" />
    </div>
  </div>

  <main class="snap-container" id="snapRoot">

    <section class="page">
      <div class="text-center space-y-4">
        <div class="inline-block px-3 py-1 rounded-full border border-white/10 bg-white/5 text-[9px] uppercase tracking-[0.4em] font-bold text-blue-400 mb-2">Neural Interface v4.5</div>
        <h1 class="text-6xl font-bold tracking-tighter" id="hero-title">Infodose</h1>
        <p class="text-white/40 font-light max-w-xs mx-auto" id="hero-subtitle">Sintonize sua frequÃªncia biolÃ³gica em doses de IA.</p>
      </div>
      <div class="absolute bottom-10 animate-bounce opacity-20"><i data-lucide="chevron-down"></i></div>
    </section>

    <section class="page">
      <div class="w-full max-w-sm space-y-6">
        <div class="text-center space-y-1 mb-8">
          <h2 class="text-xl font-bold">Protocolos Ativos</h2>
          <p class="text-[10px] uppercase tracking-widest text-white/20">Selecione sua induÃ§Ã£o</p>
        </div>
        
        <button onclick="dose('High Focus','gamma','âš¡')" class="btn-card group">
          <div class="btn-icon bg-blue-500/10 border border-blue-500/20 group-active:scale-90 transition-transform">
            <i data-lucide="zap" class="text-blue-400 w-5"></i>
          </div>
          <div class="text-left">
            <h3 class="font-bold text-sm">High Focus</h3>
            <p class="text-[10px] opacity-40">Sincronia Gamma (40Hz)</p>
          </div>
        </button>

        <button onclick="dose('Flow State','alpha','âœ¨')" class="btn-card group">
          <div class="btn-icon bg-purple-500/10 border border-purple-500/20 group-active:scale-90 transition-transform">
            <i data-lucide="sparkles" class="text-purple-400 w-5"></i>
          </div>
          <div class="text-left">
            <h3 class="font-bold text-sm">Flow State</h3>
            <p class="text-[10px] opacity-40">Ritmo Alpha (10Hz)</p>
          </div>
        </button>

        <button onclick="dose('Deep Clarity','theta','ðŸ§˜')" class="btn-card group">
          <div class="btn-icon bg-emerald-500/10 border border-emerald-500/20 group-active:scale-90 transition-transform">
            <i data-lucide="wind" class="text-emerald-400 w-5"></i>
          </div>
          <div class="text-left">
            <h3 class="font-bold text-sm">Deep Clarity</h3>
            <p class="text-[10px] opacity-40">Ondas Theta (6Hz)</p>
          </div>
        </button>
      </div>
    </section>

    <section class="page">
      <div class="w-full max-w-sm space-y-6">
        <div class="text-center space-y-1 mb-4">
          <h2 class="text-xl font-bold">Backup & Sync</h2>
          <p class="text-[10px] uppercase tracking-widest text-white/20">Gerenciamento da MemÃ³ria Neural</p>
        </div>

        <div class="management-grid">
          <button onclick="triggerImport()" class="mng-btn"><i data-lucide="upload-cloud"></i> Importar</button>
          <button onclick="exportConversation()" class="mng-btn"><i data-lucide="download-cloud"></i> Exportar</button>
          <button onclick="loadConversationFromLocalStorage()" class="mng-btn"><i data-lucide="refresh-cw"></i> Load LS</button>
          <button onclick="clearConversation()" class="mng-btn text-red-400/50"><i data-lucide="trash-2"></i> Reset</button>
        </div>

        <input id="di_import_file" type="file" accept="application/json" class="hidden" />

        <div class="dash-card">
          <div class="flex justify-between items-center cursor-pointer" onclick="toggleAccordion('mode-settings')">
            <h4 class="text-[10px] font-bold uppercase tracking-widest text-white/40">Modo do Sistema</h4>
            <i data-lucide="settings" class="w-3 opacity-30"></i>
          </div>
          <div id="mode-settings" class="acc-content">
            <div class="pt-4 flex gap-3">
              <button id="btn-eco" onclick="setAppMode('eco')" class="flex-1 py-3 rounded-xl border border-white/5 bg-white/5 text-[10px] font-bold uppercase tracking-widest opacity-40 [&.active]:opacity-100 [&.active]:border-emerald-500/40">Eco</button>
              <button id="btn-perf" onclick="setAppMode('perf')" class="flex-1 py-3 rounded-xl border border-white/5 bg-white/5 text-[10px] font-bold uppercase tracking-widest opacity-40 [&.active]:opacity-100 [&.active]:border-blue-500/40">Performance</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="page">
      <div class="dash-card">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-sm font-bold uppercase tracking-widest">Neural Logs</h3>
          <button onclick="renderLogs()" class="p-2 bg-white/5 rounded-lg border border-white/5"><i data-lucide="refresh-ccw" class="w-4 opacity-50"></i></button>
        </div>
        <div id="log-container" class="log-list"></div>
        <div class="mt-6 pt-4 border-t border-white/5 flex justify-between items-center text-[9px] uppercase font-bold tracking-widest text-white/20">
          <span>Status: Online</span>
          <span id="log-count">0 Doses</span>
        </div>
      </div>
    </section>

  </main>

  <!-- Dose Session Overlay -->
  <div id="active-ui">
    <div id="dynamic-bg" class="absolute inset-0 opacity-20 pointer-events-none"></div>
    
    <div class="absolute top-10 w-full flex justify-center px-10">
        <button onclick="minimize()" class="flex items-center gap-2 text-[9px] font-bold uppercase tracking-[0.3em] text-white/30 hover:text-white transition-colors bg-white/5 px-4 py-2 rounded-full border border-white/10">
            <i data-lucide="minimize-2" class="w-3"></i> Continuar Navegando
        </button>
    </div>

    <div class="relative z-10 text-center space-y-8 px-8 max-w-md">
      <div class="relative w-28 h-28 mx-auto flex items-center justify-center">
        <div class="absolute inset-0 border-2 border-white/5 rounded-full animate-[ping_3s_infinite] opacity-20"></div>
        <div id="status-icon" class="text-5xl">ðŸ’Š</div>
      </div>
      <h2 id="status-text" class="text-[10px] font-bold uppercase tracking-[0.5em] text-blue-400">Calibrando...</h2>
      <div id="dose-display" class="min-h-[140px] flex items-center justify-center">
        <p id="ai-text" class="text-xl md:text-2xl font-light italic leading-relaxed text-white/90"></p>
      </div>
      <div class="flex flex-col gap-4">
          <button onclick="terminate()" class="glass-pill px-10 py-5 text-[10px] font-bold uppercase tracking-[0.3em] text-red-400/80 hover:text-red-400 bg-red-500/5">Encerrar Dose</button>
          <p id="user-context" class="text-[9px] uppercase tracking-widest text-white/20 font-bold"></p>
      </div>
    </div>
  </div>

  <div id="di_toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] space-y-2 pointer-events-none"></div>

  <script>
    const DI_CONV_KEY = 'di_conversation';
    let conversation = [];
    let audioCtx = null, osc = null, gainNode = null;
    let appMode = localStorage.getItem('di_appMode') || 'eco';
    let typingSpeed = 35;
    let doseActive = false;

    const di_userName = localStorage.getItem('di_userName') || 'Viajante';
    const di_infodoseName = localStorage.getItem('di_infodoseName') || 'Nexus';
    const di_modelName = localStorage.getItem('di_modelName') || '';

    lucide.createIcons();
    document.getElementById('displayUser').innerText = di_userName;
    document.getElementById('hero-title').innerText = di_infodoseName;
    document.getElementById('hero-subtitle').innerText = `SaudaÃ§Ãµes, ${di_userName}. Sintonize sua frequÃªncia biolÃ³gica.`;
    if(di_modelName) document.getElementById('id_modelName').value = di_modelName;

    window.onload = () => {
      setAppMode(appMode, false);
      const saved = localStorage.getItem(DI_CONV_KEY);
      if(saved) conversation = JSON.parse(saved);
      renderLogs();
    };

    function setAppMode(mode, notify = true) {
      appMode = mode;
      localStorage.setItem('di_appMode', mode);
      document.getElementById('btn-eco').classList.toggle('active', mode === 'eco');
      document.getElementById('btn-perf').classList.toggle('active', mode === 'perf');
      const dot = document.getElementById('status-dot');
      if(mode === 'perf') {
        dot.className = "w-2 h-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.8)]";
        typingSpeed = 50;
      } else {
        dot.className = "w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981]";
        typingSpeed = 30;
      }
      if(notify) toast(`Protocolo ${mode.toUpperCase()} Ativado`);
    }

    function toggleAccordion(id) { document.getElementById(id).classList.toggle('open'); }

    function renderLogs() {
      const container = document.getElementById('log-container');
      const countEl = document.getElementById('log-count');
      if(!conversation.length) return;
      countEl.innerText = `${conversation.length} Doses`;
      container.innerHTML = conversation.slice(-10).reverse().map(log => `
        <div class="log-item" style="border-color: ${log.color || '#3b82f6'}">
          <div class="flex justify-between opacity-30 text-[9px] mb-1 font-bold">
            <span>${log.state.toUpperCase()}</span>
            <span>${new Date(log.ts).toLocaleTimeString()}</span>
          </div>
          <div class="text-white/80 italic">"${log.aiText}"</div>
        </div>
      `).join('');
    }

    // --- Audio with Fade In/Out ---
    function startAudio(freq) {
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if(osc) { stopAudio(); } // Reset previous if any

      osc = audioCtx.createOscillator();
      gainNode = audioCtx.createGain();
      
      let f = 200;
      if(freq === 'gamma') f = 240;
      else if(freq === 'alpha') f = 210;
      else if(freq === 'theta') f = 206;

      osc.frequency.setValueAtTime(f, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
      
      // FADE IN
      gainNode.gain.exponentialRampToValueAtTime(appMode === 'perf' ? 0.08 : 0.03, audioCtx.currentTime + 3);
      
      osc.connect(gainNode);
      gainNode.connect(audioCtx.destination);
      osc.start();
    }

    function stopAudio() {
      if(gainNode && audioCtx) {
        // FADE OUT
        const now = audioCtx.currentTime;
        gainNode.gain.cancelScheduledValues(now);
        gainNode.gain.setValueAtTime(gainNode.gain.value, now);
        gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 1.5);
        
        const oldOsc = osc;
        setTimeout(() => { 
            try { oldOsc.stop(); } catch(e) {}
        }, 1600);
      }
    }

    // --- Dose Management ---
    async function dose(state, freq, icon) {
      doseActive = true;
      document.getElementById('active-tag').classList.remove('hidden');
      const ui = document.getElementById('active-ui');
      const textDisplay = document.getElementById('ai-text');
      const status = document.getElementById('status-text');
      const context = document.getElementById('user-context');
      const bg = document.getElementById('dynamic-bg');

      ui.classList.add('visible');
      document.getElementById('status-icon').innerText = icon;
      textDisplay.innerText = "";
      status.innerText = "Sincronizando FrequÃªncia...";
      context.innerText = `${di_infodoseName} + ${di_userName}`;
      
      const color = freq === 'gamma' ? '#60a5fa' : (freq === 'alpha' ? '#a855f7' : '#34d399');
      status.style.color = color;
      bg.style.background = `radial-gradient(circle at center, ${color}33 0%, transparent 70%)`;

      startAudio(freq);

      const model = document.getElementById('id_modelName').value || localStorage.getItem('di_modelName');
      const apiKey = localStorage.getItem('di_apiKey');
      let aiText = `${di_userName}, permita que o ${di_infodoseName} alinhe sua respiraÃ§Ã£o agora.`;

      if(apiKey && model) {
        try {
          const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
          const r = await fetch(url, {
            method:'POST',
            body:JSON.stringify({contents:[{parts:[{text:`VocÃª Ã© o assistente ${di_infodoseName}. O usuÃ¡rio Ã© ${di_userName}. FrequÃªncia: ${state}. Gere uma instruÃ§Ã£o de biohacking poÃ©tica e tÃ©cnica de 8 palavras.`}]}]})
          });
          const d = await r.json();
          aiText = d?.candidates?.[0]?.content?.parts?.[0]?.text || aiText;
        } catch(e) { console.error(e); }
      }

      let i = 0;
      const type = () => {
        if(!doseActive) return;
        if(i < aiText.length) {
          textDisplay.innerText += aiText.charAt(i++);
          setTimeout(type, typingSpeed);
        } else {
          status.innerText = "InduÃ§Ã£o EstÃ¡vel";
          conversation.push({ state, aiText, ts: Date.now(), color });
          localStorage.setItem(DI_CONV_KEY, JSON.stringify(conversation));
          renderLogs();
        }
      };
      setTimeout(type, 1200);
    }

    function minimize() {
        document.getElementById('active-ui').classList.remove('visible');
        toast("Dose Ativa em Background");
    }

    function restoreActiveUI() {
        if(doseActive) {
            document.getElementById('active-ui').classList.add('visible');
        } else {
            document.getElementById('snapRoot').scrollTo({top: 0, behavior: 'smooth'});
        }
    }

    function terminate() {
      doseActive = false;
      stopAudio();
      document.getElementById('active-tag').classList.add('hidden');
      const ui = document.getElementById('active-ui');
      ui.style.opacity = '0';
      setTimeout(() => {
        ui.classList.remove('visible');
        ui.style.opacity = '1';
        toast("ConexÃ£o Encerrada");
      }, 500);
    }

    // --- System Utils ---
    function toast(msg) {
      const t = document.getElementById('di_toast');
      const el = document.createElement('div');
      el.className = 'glass-pill px-4 py-2 text-[9px] font-bold uppercase tracking-widest border-white/10 text-white/80 animate-bounce';
      el.innerText = msg;
      t.appendChild(el);
      setTimeout(() => el.remove(), 2500);
    }

    function exportConversation() {
      const blob = new Blob([JSON.stringify(conversation, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `infodose_logs_${Date.now()}.json`;
      a.click();
      toast('Logs Exportados');
    }

    function triggerImport() { document.getElementById('di_import_file').click(); }
    document.getElementById('di_import_file').onchange = async (e) => {
      const file = e.target.files[0];
      if(!file) return;
      const text = await file.text();
      conversation = JSON.parse(text);
      localStorage.setItem(DI_CONV_KEY, JSON.stringify(conversation));
      renderLogs();
      toast('Sincronizado');
    };

    function loadConversationFromLocalStorage() {
      const saved = localStorage.getItem(DI_CONV_KEY);
      if(saved) { conversation = JSON.parse(saved); renderLogs(); toast('MemÃ³ria Restaurada'); }
    }

    function clearConversation() {
      if(confirm("Deseja apagar sua memÃ³ria neural?")) {
        conversation = [];
        localStorage.removeItem(DI_CONV_KEY);
        renderLogs();
        toast('Reset de FÃ¡brica');
      }
    }
  </script>
</body>
</html>

