<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Infodose ‚Äî Biohacking Neural</title>

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3062/3062125.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --bg:#000;
      --accent:#fff;
      --glass:rgba(255,255,255,0.04);
      --glass-2:rgba(255,255,255,0.06);
      --muted:rgba(255,255,255,0.48);
      --pill-radius:28px;
    }

    * { box-sizing:border-box; -webkit-tap-highlight-color:transparent; outline:none; }
    html,body { height:100%; margin:0; background:var(--bg); color:#fff; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Segoe UI,Roboto,Helvetica,Arial; -webkit-font-smoothing:antialiased; overflow: hidden; }

    /* Snap Scroll System */
    .snap-container {
      height:100vh;
      overflow-y:auto;
      scroll-snap-type:y mandatory;
      scroll-behavior: smooth;
    }
    section.page {
      min-height:100vh;
      scroll-snap-align:start;
      display:flex;
      flex-direction: column;
      align-items:center;
      justify-content:center;
      padding:2rem;
      position: relative;
    }

    /* Glass Morphism */
    .glass-pill { background:var(--glass); backdrop-filter:blur(24px); -webkit-backdrop-filter:blur(24px); border-radius:var(--pill-radius); border:1px solid rgba(255,255,255,0.08); transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    .glass-pill:active { transform:scale(.97); background: rgba(255,255,255,0.1); }

    /* Button Cards */
    .btn-card { display:flex; align-items:center; gap:16px; padding:16px; border-radius:20px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.05); cursor:pointer; width:100%; transition: all 0.3s; }
    .btn-card:hover { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.1); }
    .btn-icon { width:52px; height:52px; border-radius:14px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }

    /* Management Section Specifics */
    .management-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; max-width: 400px; }
    .mng-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; padding: 20px; border-radius: 20px; background: var(--glass); border: 1px solid rgba(255,255,255,0.05); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); }
    .mng-btn i { opacity: 0.6; }
    .mng-btn:active { background: rgba(255,255,255,0.1); color: #fff; }

    /* Dashboard & Logs */
    .dash-card { background: rgba(10,10,10,0.5); border: 1px solid rgba(255,255,255,0.04); border-radius: 24px; padding: 20px; width: 100%; max-width: 500px; }
    .log-list { max-height: 200px; overflow-y: auto; padding-right: 8px; }
    .log-item { padding: 12px; border-radius: 12px; background: rgba(255,255,255,0.02); margin-bottom: 8px; border-left: 2px solid #3b82f6; font-size: 11px; line-height: 1.4; }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

    /* Active Interface Overlay */
    #active-ui { position:fixed; inset:0; z-index:100; display:none; flex-direction:column; align-items:center; justify-content:center; background:#000; }
    #active-ui.visible { display:flex; animation: fadeIn 0.5s forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Accordion */
    .acc-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
    .acc-content.open { max-height: 300px; }

    #top-bar { position:fixed; top:0; left:0; right:0; z-index:80; padding: 16px; display:flex; justify-content:space-between; pointer-events:none; }
    .panel-pill { pointer-events:auto; padding: 8px 14px; background: rgba(255,255,255,0.05); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; display: flex; align-items: center; gap: 8px; }
  </style>
</head>
<body>

  <!-- Top HUD -->
  <div id="top-bar">
    <div class="panel-pill">
      <div id="status-dot" class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981]"></div>
      <span id="displayUser" class="text-[10px] font-bold tracking-widest uppercase">Syncing...</span>
    </div>
    <div class="panel-pill">
      <i data-lucide="cpu" class="w-3 opacity-40"></i>
      <input id="id_modelName" type="text" placeholder="MODEL_ID" class="bg-transparent border-none text-[10px] w-24 focus:ring-0 text-white font-mono" />
    </div>
  </div>

  <main class="snap-container" id="snapRoot">

    <!-- Page 1: Hero -->
    <section class="page">
      <div class="text-center space-y-4">
        <div class="inline-block px-3 py-1 rounded-full border border-white/10 bg-white/5 text-[9px] uppercase tracking-[0.4em] font-bold text-blue-400 mb-2">Neural Interface v4.0</div>
        <h1 class="text-6xl font-bold tracking-tighter">Infodose</h1>
        <p class="text-white/40 font-light max-w-xs mx-auto">Sintonize sua frequ√™ncia biol√≥gica em doses de IA.</p>
      </div>
      <div class="absolute bottom-10 animate-bounce opacity-20"><i data-lucide="chevron-down"></i></div>
    </section>

    <!-- Page 2: Protocols -->
    <section class="page">
      <div class="w-full max-w-sm space-y-6">
        <div class="text-center space-y-1 mb-8">
          <h2 class="text-xl font-bold">Protocolos Ativos</h2>
          <p class="text-[10px] uppercase tracking-widest text-white/20">Selecione sua indu√ß√£o</p>
        </div>
        
        <button onclick="dose('High Focus','gamma','‚ö°')" class="btn-card group">
          <div class="btn-icon bg-blue-500/10 border border-blue-500/20 group-active:scale-90 transition-transform">
            <i data-lucide="zap" class="text-blue-400 w-5"></i>
          </div>
          <div class="text-left">
            <h3 class="font-bold text-sm">High Focus</h3>
            <p class="text-[10px] opacity-40">Sincronia Gamma (40Hz)</p>
          </div>
        </button>

        <button onclick="dose('Flow State','alpha','‚ú®')" class="btn-card group">
          <div class="btn-icon bg-purple-500/10 border border-purple-500/20 group-active:scale-90 transition-transform">
            <i data-lucide="sparkles" class="text-purple-400 w-5"></i>
          </div>
          <div class="text-left">
            <h3 class="font-bold text-sm">Flow State</h3>
            <p class="text-[10px] opacity-40">Ritmo Alpha (10Hz)</p>
          </div>
        </button>

        <button onclick="dose('Deep Clarity','theta','üßò')" class="btn-card group">
          <div class="btn-icon bg-emerald-500/10 border border-emerald-500/20 group-active:scale-90 transition-transform">
            <i data-lucide="wind" class="text-emerald-400 w-5"></i>
          </div>
          <div class="text-left">
            <h3 class="font-bold text-sm">Deep Clarity</h3>
            <p class="text-[10px] opacity-40">Ondas Theta (6Hz)</p>
          </div>
        </button>
      </div>
      <div class="absolute bottom-10 opacity-10 uppercase text-[9px] tracking-[0.4em] font-bold">Gest√£o de Sistema</div>
    </section>

    <!-- Page 3: Management (The "Sliding Section") -->
    <section class="page">
      <div class="w-full max-w-sm space-y-6">
        <div class="text-center space-y-1 mb-4">
          <h2 class="text-xl font-bold">Backup & Sync</h2>
          <p class="text-[10px] uppercase tracking-widest text-white/20">Gerenciamento da Mem√≥ria Neural</p>
        </div>

        <div class="management-grid">
          <button onclick="triggerImport()" class="mng-btn">
            <i data-lucide="upload-cloud" class="w-5"></i> Importar
          </button>
          <button onclick="exportConversation()" class="mng-btn">
            <i data-lucide="download-cloud" class="w-5"></i> Exportar
          </button>
          <button onclick="loadConversationFromLocalStorage()" class="mng-btn">
            <i data-lucide="refresh-cw" class="w-5"></i> Load LS
          </button>
          <button onclick="clearConversation()" class="mng-btn text-red-400/50">
            <i data-lucide="trash-2" class="w-5"></i> Reset
          </button>
        </div>

        <input id="di_import_file" type="file" accept="application/json" class="hidden" />

        <!-- App Mode Accordion -->
        <div class="dash-card">
          <div class="flex justify-between items-center cursor-pointer" onclick="toggleAccordion('mode-settings')">
            <h4 class="text-[10px] font-bold uppercase tracking-widest text-white/40">Modo do Sistema</h4>
            <i data-lucide="settings" class="w-3 opacity-30"></i>
          </div>
          <div id="mode-settings" class="acc-content">
            <div class="pt-4 flex gap-3">
              <button id="btn-eco" onclick="setAppMode('eco')" class="flex-1 py-3 rounded-xl border border-white/5 bg-white/5 text-[10px] font-bold uppercase tracking-widest opacity-40 [&.active]:opacity-100 [&.active]:border-emerald-500/40 active">Eco</button>
              <button id="btn-perf" onclick="setAppMode('perf')" class="flex-1 py-3 rounded-xl border border-white/5 bg-white/5 text-[10px] font-bold uppercase tracking-widest opacity-40 [&.active]:opacity-100 [&.active]:border-blue-500/40">Performance</button>
            </div>
            <p class="text-[9px] text-white/20 mt-3 italic leading-relaxed text-center">Modo Performance habilita √°udio binaural HD e anima√ß√µes de alta fidelidade.</p>
          </div>
        </div>
      </div>
      <div class="absolute bottom-10 opacity-10 uppercase text-[9px] tracking-[0.4em] font-bold">Logs de Atividade</div>
    </section>

    <!-- Page 4: Dashboard & Logs -->
    <section class="page">
      <div class="dash-card">
        <div class="flex justify-between items-center mb-6">
          <div>
            <h3 class="text-sm font-bold uppercase tracking-widest">Neural Logs</h3>
            <p class="text-[9px] text-white/30">Registros de indu√ß√£o recentes</p>
          </div>
          <button onclick="renderLogs()" class="p-2 bg-white/5 rounded-lg border border-white/5 active:scale-95">
            <i data-lucide="refresh-ccw" class="w-4 opacity-50"></i>
          </button>
        </div>

        <div id="log-container" class="log-list">
          <!-- Logs injected here -->
          <p class="text-[10px] opacity-20 italic text-center py-8">Aguardando telemetria...</p>
        </div>

        <div class="mt-6 pt-4 border-t border-white/5 flex justify-between items-center text-[9px] uppercase font-bold tracking-widest text-white/20">
          <span>Status: Online</span>
          <span id="log-count">0 Doses</span>
        </div>
      </div>
    </section>

  </main>

  <!-- Active Session Interface -->
  <div id="active-ui">
    <div id="dynamic-bg" class="absolute inset-0 opacity-20 pointer-events-none"></div>
    <div class="relative z-10 text-center space-y-8 px-6 max-w-md">
      <div class="relative w-24 h-24 mx-auto flex items-center justify-center">
        <div class="absolute inset-0 border-2 border-white/10 rounded-full animate-ping opacity-20"></div>
        <div id="status-icon" class="text-4xl">üíä</div>
      </div>
      <h2 id="status-text" class="text-[10px] font-bold uppercase tracking-[0.5em] text-blue-400">Calibrando...</h2>
      <div id="dose-display" class="min-h-[120px] flex items-center justify-center">
        <p id="ai-text" class="text-xl md:text-2xl font-light italic leading-relaxed text-white/90"></p>
      </div>
      <button onclick="terminate()" class="glass-pill px-10 py-4 text-[10px] font-bold uppercase tracking-[0.3em] text-white/30 hover:text-white">Encerrar Dose</button>
    </div>
  </div>

  <div id="di_toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] space-y-2 pointer-events-none"></div>

  <script>
    const DI_CONV_KEY = 'di_conversation';
    let conversation = [];
    let audioCtx = null, osc = null, gain = null;
    let appMode = localStorage.getItem('di_appMode') || 'eco';
    let typingSpeed = 35;

    // Load sacred keys
    const di_userName = localStorage.getItem('di_userName') || 'Usu√°rio';
    const di_infodoseName = localStorage.getItem('di_infodoseName') || 'Infodose';
    const di_modelName = localStorage.getItem('di_modelName') || '';

    // Init UI
    lucide.createIcons();
    document.getElementById('displayUser').innerText = di_userName;
    if(di_modelName) document.getElementById('id_modelName').value = di_modelName;

    window.onload = () => {
      setAppMode(appMode, false);
      const saved = localStorage.getItem(DI_CONV_KEY);
      if(saved) conversation = JSON.parse(saved);
      renderLogs();
    };

    // --- App Logic ---

    function setAppMode(mode, notify = true) {
      appMode = mode;
      localStorage.setItem('di_appMode', mode);
      document.getElementById('btn-eco').classList.toggle('active', mode === 'eco');
      document.getElementById('btn-perf').classList.toggle('active', mode === 'perf');
      
      const dot = document.getElementById('status-dot');
      if(mode === 'perf') {
        dot.className = "w-2 h-2 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.8)]";
        typingSpeed = 45;
      } else {
        dot.className = "w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981]";
        typingSpeed = 20;
      }
      if(notify) toast(`Modo ${mode.toUpperCase()} Ativado`);
    }

    function toggleAccordion(id) {
      document.getElementById(id).classList.toggle('open');
    }

    function renderLogs() {
      const container = document.getElementById('log-container');
      const countEl = document.getElementById('log-count');
      if(!conversation.length) return;

      countEl.innerText = `${conversation.length} Doses`;
      container.innerHTML = conversation.slice(-10).reverse().map(log => `
        <div class="log-item" style="border-color: ${log.color || '#3b82f6'}">
          <div class="flex justify-between opacity-30 text-[9px] mb-1 font-bold">
            <span>${log.state.toUpperCase()}</span>
            <span>${new Date(log.ts).toLocaleTimeString()}</span>
          </div>
          <div class="text-white/80 italic">"${log.aiText}"</div>
        </div>
      `).join('');
    }

    // --- Audio System ---
    function startAudio(freq) {
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      osc = audioCtx.createOscillator();
      gain = audioCtx.createGain();
      
      let f = 200;
      if(freq === 'gamma') f = 240;
      if(freq === 'alpha') f = 210;
      if(freq === 'theta') f = 206;

      osc.frequency.setValueAtTime(f, audioCtx.currentTime);
      gain.gain.setValueAtTime(0, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(appMode === 'perf' ? 0.06 : 0.02, audioCtx.currentTime + 2);
      
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
    }

    function stopAudio() {
      if(gain) {
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
        setTimeout(() => { if(osc) osc.stop(); }, 600);
      }
    }

    // --- Dose Execution ---
    async function dose(state, freq, icon) {
      const ui = document.getElementById('active-ui');
      const textDisplay = document.getElementById('ai-text');
      const status = document.getElementById('status-text');
      const bg = document.getElementById('dynamic-bg');

      ui.classList.add('visible');
      document.getElementById('status-icon').innerText = icon;
      textDisplay.innerText = "";
      status.innerText = "Sincronizando...";
      
      const color = freq === 'gamma' ? '#60a5fa' : (freq === 'alpha' ? '#a855f7' : '#34d399');
      status.style.color = color;
      bg.style.background = `radial-gradient(circle at center, ${color}33 0%, transparent 70%)`;

      startAudio(freq);

      // AI Logic
      const model = document.getElementById('id_modelName').value || localStorage.getItem('di_modelName');
      const apiKey = localStorage.getItem('di_apiKey');
      let aiText = "Respire. Sinta a pulsa√ß√£o neural alinhando sua consci√™ncia.";

      if(apiKey && model) {
        try {
          const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
          const r = await fetch(url, {
            method:'POST',
            body:JSON.stringify({contents:[{parts:[{text:`Usu√°rio: ${di_userName}. Frequ√™ncia: ${state}. Gere uma dose de biohacking (10 palavras max).`}]}]})
          });
          const d = await r.json();
          aiText = d?.candidates?.[0]?.content?.parts?.[0]?.text || aiText;
        } catch(e) { console.error(e); }
      }

      // Typing
      let i = 0;
      const type = () => {
        if(i < aiText.length) {
          textDisplay.innerText += aiText.charAt(i++);
          setTimeout(type, typingSpeed);
        } else {
          status.innerText = "Dose Aplicada";
          conversation.push({ state, aiText, ts: Date.now(), color });
          localStorage.setItem(DI_CONV_KEY, JSON.stringify(conversation));
          renderLogs();
        }
      };
      setTimeout(type, 1000);
    }

    function terminate() {
      stopAudio();
      const ui = document.getElementById('active-ui');
      ui.style.opacity = '0';
      setTimeout(() => {
        ui.classList.remove('visible');
        ui.style.opacity = '1';
      }, 500);
    }

    // --- Data Management ---
    function toast(msg) {
      const t = document.getElementById('di_toast');
      const el = document.createElement('div');
      el.className = 'glass-pill px-4 py-2 text-[9px] font-bold uppercase tracking-widest border-white/10 text-white/80 animate-bounce';
      el.innerText = msg;
      t.appendChild(el);
      setTimeout(() => el.remove(), 3000);
    }

    function exportConversation() {
      const blob = new Blob([JSON.stringify(conversation, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `infodose_backup_${Date.now()}.json`;
      a.click();
      toast('Logs Exportados');
    }

    function triggerImport() { document.getElementById('di_import_file').click(); }
    document.getElementById('di_import_file').onchange = async (e) => {
      const file = e.target.files[0];
      if(!file) return;
      const text = await file.text();
      conversation = JSON.parse(text);
      localStorage.setItem(DI_CONV_KEY, JSON.stringify(conversation));
      renderLogs();
      toast('Importa√ß√£o Conclu√≠da');
    };

    function loadConversationFromLocalStorage() {
      const saved = localStorage.getItem(DI_CONV_KEY);
      if(saved) {
        conversation = JSON.parse(saved);
        renderLogs();
        toast('Sincronizado');
      }
    }

    function clearConversation() {
      if(confirm("Deseja apagar todos os registros neurais?")) {
        conversation = [];
        localStorage.removeItem(DI_CONV_KEY);
        renderLogs();
        toast('Mem√≥ria Limpa');
      }
    }

  </script>
</body>
</html>

